<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="åŸºäºç§‹é˜³åˆ›å·´ä»æ³¢åˆ‡æ•™æ³•çš„ AI å¯¹è¯åŠ©æ‰‹">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>ChÃ¶gyam Trungpa æ•™æ³•çŸ¥è¯†åº“</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #333333;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background: #ffffff;
      border: 1px solid #f0f0f0;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: #ffffff;
      color: #333333;
      padding: 30px 20px;
      text-align: center;
      border-bottom: 1px solid #f0f0f0;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      color: #666666;
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #ffffff;
    }

    .message {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
    }

    .message.user {
      align-items: flex-end;
    }

    .message.assistant {
      align-items: flex-start;
    }

    .message-content {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 8px;
      line-height: 1.6;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .message.user .message-content {
      background: #f5f5f5;
      color: #333333;
      border: 1px solid #e8e8e8;
      border-bottom-right-radius: 4px;
    }

    .message.assistant .message-content {
      background: #ffffff;
      color: #333333;
      border: 1px solid #f0f0f0;
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02);
    }

    .message-sources {
      font-size: 11px;
      color: #999999;
      margin-top: 5px;
      padding: 0 4px;
    }

    .input-container {
      padding: 20px;
      background: #ffffff;
      border-top: 1px solid #f0f0f0;
      display: flex;
      gap: 10px;
    }

    #messageInput {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e8e8e8;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.2s;
      background: #fafafa;
    }

    #messageInput:focus {
      outline: none;
      border-color: #333333;
      background: #ffffff;
    }

    #sendButton {
      padding: 12px 24px;
      background: #333333;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #sendButton:hover {
      background: #000000;
    }

    #sendButton:active {
      transform: translateY(0);
    }

    #sendButton:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .typing-indicator {
      display: none;
      align-items: center;
      gap: 5px;
      padding: 12px 16px;
      background: #f5f5f5;
      border: 1px solid #e8e8e8;
      border-radius: 8px;
      margin-bottom: 20px;
      width: fit-content;
    }

    .typing-indicator span {
      width: 6px;
      height: 6px;
      background: #333333;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.3;
      }
      30% {
        transform: translateY(-4px);
        opacity: 1;
      }
    }

    .welcome-message {
      text-align: center;
      color: #666666;
      margin-top: 30px;
      padding: 0 40px;
    }

    .welcome-message h2 {
      font-size: 18px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 20px;
    }

    .welcome-message p {
      font-size: 14px;
      line-height: 1.8;
      color: #666666;
      margin-bottom: 16px;
    }

    .categories {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .category-item {
      padding: 14px 16px;
      background: #fafafa;
      border: 1px solid #f0f0f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .category-item:hover {
      background: #ffffff;
      border-color: #333333;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .category-title {
      font-size: 14px;
      font-weight: 500;
      color: #333333;
      margin-bottom: 4px;
    }

    .category-desc {
      font-size: 12px;
      color: #999999;
    }

    @media (max-width: 600px) {
      .container {
        height: 90vh;
      }

      .message-content {
        max-width: 90%;
      }

      .categories {
        grid-template-columns: 1fr;
      }

      .welcome-message {
        padding: 0 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“š ChÃ¶gyam Trungpa æ•™æ³•çŸ¥è¯†åº“</h1>
      <p>åŸºäº 11 æœ¬ä¹¦ï¼Œ6873 é¡µå†…å®¹çš„ AI å¯¹è¯åŠ©æ‰‹</p>
    </div>

    <div class="chat-container" id="chatContainer">
      <div class="welcome-message" id="welcomeMessage">
        <h2>ğŸ™ æ¬¢è¿ä½¿ç”¨</h2>
        <p>æ‚¨å¯ä»¥è‡ªç”±æé—®ä»»ä½•å…³äº ChÃ¶gyam Trungpa å–‡å˜›æ•™æ³•çš„é—®é¢˜ã€‚ä¸ºäº†å¸®åŠ©æ‚¨æ›´å¥½åœ°æ¢ç´¢ï¼Œè¯·ä»ä»¥ä¸‹åˆ†ç±»ä¸­é€‰æ‹©ï¼š</p>
        
        <div class="categories">
          <div class="category-item" onclick="askQuestion('ä»€ä¹ˆæ˜¯ç²¾ç¥å”¯ç‰©ä¸»ä¹‰ï¼Ÿ')">
            <div class="category-title">ç²¾ç¥å”¯ç‰©ä¸»ä¹‰</div>
            <div class="category-desc">ç†è§£çµæ€§è¿½æ±‚ä¸­çš„ç‰©è´¨åŒ–å€¾å‘</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('å¦‚ä½•ä¿®ä¹ æ­£å¿µå†¥æƒ³ï¼Ÿ')">
            <div class="category-title">æ­£å¿µå†¥æƒ³</div>
            <div class="category-desc">ä¿®ä¹ æ­£å¿µä¸è§‰çŸ¥çš„æ–¹æ³•</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('è§£é‡Šå¤§æ‰‹å°çš„æ¦‚å¿µ')">
            <div class="category-title">å¤§æ‰‹å°</div>
            <div class="category-desc">è—ä¼ ä½›æ•™çš„æœ€é«˜æ•™æ³•</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä»€ä¹ˆæ˜¯åŸºæœ¬å–„ï¼Ÿ')">
            <div class="category-title">åŸºæœ¬å–„</div>
            <div class="category-desc">æ¯ä¸ªäººä¸ç”Ÿä¿±æ¥çš„çº¯å‡€å“è´¨</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä¸Šå¸ˆåœ¨ä¿®è¡Œä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ')">
            <div class="category-title">ä¸Šå¸ˆä¸ä¼ æ‰¿</div>
            <div class="category-desc">ç†è§£çµæ€§å¯¼å¸ˆçš„é‡è¦æ€§</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä»€ä¹ˆæ˜¯é¦™å·´æ‹‰ä¹‹é“ï¼Ÿ')">
            <div class="category-title">é¦™å·´æ‹‰ä¼ ç»Ÿ</div>
            <div class="category-desc">å°†ä½›æ³•æ™ºæ…§èå…¥æ—¥å¸¸ç”Ÿæ´»</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä»€ä¹ˆæ˜¯æˆ’å¾‹å’Œé“å¾·ï¼Ÿ')">
            <div class="category-title">æˆ’å¾‹ä¸é“å¾·</div>
            <div class="category-desc">ä½›æ•™ä¿®è¡Œä¸­çš„è¡Œä¸ºå‡†åˆ™</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('å¦‚ä½•å…‹æœè‡ªæˆ‘ï¼Ÿ')">
            <div class="category-title">è¶…è¶Šè‡ªæˆ‘</div>
            <div class="category-desc">æ”¾ä¸‹å°æˆ‘çš„æ™ºæ…§æ•™å¯¼</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä»€ä¹ˆæ˜¯ç¦…ä¿®ï¼Ÿ')">
            <div class="category-title">ç¦…ä¿®æ–¹æ³•</div>
            <div class="category-desc">å„ç§å†¥æƒ³ä¸ä¿®è¡Œçš„æŠ€å·§</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('ä½›æ€§ä¸è§‰æ‚Ÿçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ')">
            <div class="category-title">ä½›æ€§ä¸è§‰æ‚Ÿ</div>
            <div class="category-desc">ç†è§£è§‰æ‚Ÿçš„æœ¬è´¨ä¸æ½œèƒ½</div>
          </div>
          
          <div class="category-item" onclick="askQuestion('å¦‚ä½•åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä¿®è¡Œï¼Ÿ')">
            <div class="category-title">ç”Ÿæ´»ä¿®è¡Œ</div>
            <div class="category-desc">å°†ä½›æ³•èå…¥æ—¥å¸¸ç”Ÿæ´»çš„æŒ‡å—</div>
          </div>
        </div>
        
        <p style="margin-top: 24px; font-size: 13px; color: #999;">
          ğŸ’¡ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­è‡ªç”±æé—®
        </p>
      </div>
      
      <div class="typing-indicator" id="typingIndicator">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <div class="input-container">
      <input
        type="text"
        id="messageInput"
        placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
        autocomplete="off"
      >
      <button id="sendButton">å‘é€</button>
    </div>
  </div>

  <script>
    const chatContainer = document.getElementById('chatContainer');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const typingIndicator = document.getElementById('typingIndicator');
    const welcomeMessage = document.getElementById('welcomeMessage');

    let chatHistory = [];

    // åˆ†ç±»æé—®
    function askQuestion(question) {
      messageInput.value = question;
      sendMessage();
    }

    // æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
    function addMessage(role, content, sources = []) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role}`;

      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.textContent = content;

      messageDiv.appendChild(contentDiv);

      if (sources && sources.length > 0) {
        const sourcesDiv = document.createElement('div');
        sourcesDiv.className = 'message-sources';
        sourcesDiv.textContent = `æ¥æº: ${sources.join(', ')}`;
        messageDiv.appendChild(sourcesDiv);
      }

      chatContainer.insertBefore(messageDiv, typingIndicator);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      return messageDiv;
    }

    // å‘é€æ¶ˆæ¯
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      // éšè—æ¬¢è¿æ¶ˆæ¯
      welcomeMessage.style.display = 'none';

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      addMessage('user', message);
      chatHistory.push({ role: 'user', content: message });

      // æ¸…ç©ºè¾“å…¥æ¡†
      messageInput.value = '';
      sendButton.disabled = true;

      // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
      typingIndicator.style.display = 'flex';
      chatContainer.scrollTop = chatContainer.scrollHeight;

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: message,
            history: chatHistory
          })
        });

        const data = await response.json();

        if (data.error) {
          addMessage('assistant', `é”™è¯¯: ${data.error}`);
        } else {
          addMessage('assistant', data.response, data.sources);
          chatHistory.push({ role: 'assistant', content: data.response });
        }
      } catch (error) {
        addMessage('assistant', `ç½‘ç»œé”™è¯¯: ${error.message}`);
      } finally {
        typingIndicator.style.display = 'none';
        sendButton.disabled = false;
        messageInput.focus();
      }
    }

    // äº‹ä»¶ç›‘å¬
    sendButton.addEventListener('click', sendMessage);

    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
    fetch('/api/health')
      .then(res => res.json())
      .then(data => {
        console.log('æœåŠ¡å™¨çŠ¶æ€:', data);
      })
      .catch(err => {
        console.error('æ— æ³•è¿æ¥æœåŠ¡å™¨:', err);
      });
  </script>
</body>
</html>
